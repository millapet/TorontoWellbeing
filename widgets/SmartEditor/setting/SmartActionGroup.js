// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/SmartEditor/setting/SmartActionGroup.html":'\x3cdiv class\x3d"esriCTSmartActionsGroupContainer"\x3e\r\n  \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n    \x3cdiv class\x3d"esriCTlabel"\x3e\r\n      ${nls.smartActionsPage.groupNameLabel}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTLayerField"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"groupNameTextBoxNode"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n    \x3cdiv class\x3d"esriCTlabelParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTlabel"\x3e\r\n        ${nls.smartActionsPage.layerForExpressionLabel}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTLayerFieldDropBox"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"layerSelectorDiv"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHintCheck"\x3e\r\n      ${nls.smartActionsPage.layerForExpressionNote}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n    \x3cdiv class\x3d"esriCTlabel"\x3e${nls.smartActionsPage.expressionText}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTExpression"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"expressionTextBoxNode" class\x3d"esriCTExpressionTextBoxNode"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"editExpressionIconNode" title\x3d"${nls.smartActionsPage.editExpressionLabel}"\x3e\r\n        \x3cdiv class\x3d"jimu-icon jimu-icon-edit" data-dojo-attach-point\x3d"editExpressionIconNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"submitWhenHiddenNode" class\x3d"esriCTlabel esriCTSubmitAttributeDataText"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n    \x3cfieldset class\x3d"esriCTFieldset"\x3e\r\n      \x3clegend class\x3d"esriCTLegendTitle"\x3e${nls.smartActionsPage.layerAndFieldsApplyLabel}\x3c/legend\x3e\r\n      \x3cdiv class\x3d"esriCTTableParentContainer" data-dojo-attach-point\x3d"tableParentContainer"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/fieldset\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-attr dojox/html/entities dojo/on dojo/query dojo/Deferred dojo/text!./SmartActionGroup.html dijit/_TemplatedMixin jimu/dijit/LayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/BaseWidgetSetting jimu/dijit/SimpleTable jimu/dijit/Popup dijit/form/ValidationTextBox jimu/dijit/CheckBox dijit/form/CheckBox jimu/dijit/Message ./FilterPage jimu/utils".split(" "),
function(C,D,g,k,h,m,x,q,E,r,n,F,G,H,y,I,J,K,A,z,B,L,M,N,O){return C([J,D,H],{baseClass:"jimu-widget-smartEditor-setting-smartActionGroup",templateString:G,_totalLayers:[],_prevAppliedOn:[],filterInfo:{filter:""},postCreate:function(){this.inherited(arguments);this._totalLayers=[];this._prevAppliedOnLayers=[];this.appliedOn&&(this._prevAppliedOnLayers=g.clone(Object.keys(this.appliedOn)));this._initComponents()},_initComponents:function(){this.groupNameTextBox=new z({required:!0,trim:!0,"class":"esriCTGroupNameTextBox"},
h.create("div",{},this.groupNameTextBoxNode));this.groupNameTextBox.validator=g.hitch(this,function(a){return a?a!==this.prevName&&this.editUtils.isDuplicateGroupName(a,this.existingGroupNames)?(this.groupNameTextBox.set("invalidMessage",this.nls.smartActionsPage.uniqueGroupNameMsg),!1):!0:(this.groupNameTextBox.set("invalidMessage",this.nls.smartActionsPage.requiredGroupNameMsg),!1)});this.name&&this.groupNameTextBox.set("value",this.name);this._initLayerSelector();this.expressionTextBox=new z({disabled:!0,
required:!0,"class":"esriCTTextBoxNode",promptMessage:this.nls.smartActionsPage.invalidExpression},h.create("div",{},this.expressionTextBoxNode));this.filterInfo&&this.filterInfo.expression&&this.expressionTextBox.set("value",this.filterInfo.expression);this.own(r(this.editExpressionIconNode,"click",g.hitch(this,this._showFilter)));this._submitHidden=new B({label:this.nls.smartActionsPage.submitAttributeText},h.create("div",{},this.submitWhenHiddenNode));this.submitWhenHidden&&this._submitHidden.setValue(this.submitWhenHidden);
this._createTable(this.appliedOn)},_addLayersDropDown:function(){var a,b;a=this._createLayerChooserMapArgs();a=new y(a);a.startup();a=new I({layerChooser:a});a.placeAt(this.layerSelectorDiv);a.startup();this._layerSelector=a;b=this._totalLayers[0];this.layerForExpression&&(a=this._jimuLayerInfos.getLayerOrTableInfoById(this.layerForExpression))&&(b=a.layerObject);this._layerSelector.setSelectedLayer(b);this.own(r(this._layerSelector,"selection-change",g.hitch(this,function(){this.expressionTextBox.get("value")&&
(new M({message:this.nls.smartActionsPage.warningMsgOnLayerChange}),this.onFilterInfoChanged({expression:"",filter:null,submitWhenHidden:!1}))})))},_createLayerChooserMapArgs:function(){return{multiple:!1,createMapResponse:this.map.webMapResponse,filter:this._createFiltersForLayerSelector()}},_createFiltersForLayerSelector:function(){return y.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0)},_initLayerSelector:function(){var a;a=this._createLayerChooserMapArgs();this._layerChooserFromMap=
new y(a);this._layerChooserFromMap.startup();a=this._layerChooserFromMap.layerInfosObj.getLayerInfoArray();var b=this._layerChooserFromMap.layerInfosObj.getTableInfoArray();b&&0<b.length&&(a=a.concat(b));this._getAllFilteredLayers(a,[])},_isLayerEditable:function(a){var b=!1;a&&a.layerObject&&(a=a.layerObject.getEditCapabilities(),a.canCreate||a.canUpdate||a.canDelete||a.canUpdateGeometry)&&(b=!0);return b},_getAllFilteredLayers:function(a,b){k.forEach(a,g.hitch(this,function(a){var c;a.isLeaf()?
(c=new F,this._layerChooserFromMap.filter(a).then(g.hitch(this,function(b){b&&this._isLayerEditable(a)&&this._totalLayers.push(a);c.resolve()})),b.push(c)):this._getAllFilteredLayers(a.newSubLayers,b)}))},_validateGroup:function(){var a;if(!this.groupNameTextBox.isValid())return this.groupNameTextBox.focus(),!1;if(this._layerSelector){if(a=this._layerSelector.getSelectedItem(),!a||!a.layerInfo||!a.layerInfo.layerObject)return!1}else return!1;return this.expressionTextBox.isValid()?!0:(this.expressionTextBox.set("disabled",
!1),this.expressionTextBox.focus(),this.expressionTextBox.set("disabled",!0),!1)},showDialog:function(){this._addLayersDropDown();var a=new A({titleLabel:this.nls.smartActionsPage.smartActionLabel,width:900,maxHeight:500,autoHeight:!1,content:this,"class":this.baseClass,buttons:[{label:this.nls.ok,onClick:g.hitch(this,function(){var b={},c=this._layerSelector.getSelectedItem().layerInfo.layerObject;if(this._validateGroup()){b.name=this.groupNameTextBox.get("value");b.submitWhenHidden=this._submitHidden.checked;
b.layerForExpression=c.id;b.filterInfo=this.filterInfo;b.appliedOn=this.appliedOn;this._applySettingsInLayer(b);for(var d in b.appliedOn){var c=b.appliedOn[d],e;for(e in c)c[e].hasOwnProperty("Priority")&&delete c[e].Priority,c[e].hasOwnProperty("ExistingExpressions")&&delete c[e].ExistingExpressions}this.emit("groupInfoUpdated",b);a.close()}})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:g.hitch(this,function(){a.close()})}],onClose:g.hitch(this,function(){})});this.groupNameTextBox.focus();
this._setMaxWidth()},_getTableData:function(){var a=[],b;k.forEach(this._layerTable.getRows(),g.hitch(this,function(c){c.layerSelector&&(b={},b.layerId=c.layerSelector.getSelectedItem().layerInfo.id,b.field=c.layerFields.getValue(),a.push(b))}));return a},_showFilter:function(a){if(!this.groupNameTextBox.isValid())return this.groupNameTextBox.focus(),!1;this._filterPage&&this._filterPage.destroy();var b=this._layerSelector.getSelectedItem().layerInfo.layerObject;this._filterPage=new N({nls:this.nls,
_resourceInfo:this._resourceInfo,_url:b.url,_layerId:b.id,_filterInfo:this.filterInfo,_groupName:this.groupNameTextBox.get("value")});this.own(r(this._filterPage,"filterInfo",g.hitch(this,function(a){this.onFilterInfoChanged(a)})));this._filterPage.popup(a)},onFilterInfoChanged:function(a){this.filterInfo=g.clone(a);this.filterInfo.filter=JSON.parse(E.decode(this.filterInfo.filter));this.expressionTextBox.set("value",a.expression);this._destroyTable();this._createTable(this.appliedOn)},_destroyTable:function(){h.empty(this.tableParentContainer)},
_createHeaderObj:function(a,b,c){var d,e=h.create("th"),f=h.create("div",{innerHTML:a.title,title:a.title});a.hasOwnProperty("headerIcon")&&(d=h.create("div",{title:a.title}));0<c&&(m.add(e,"esriCTTableTH"),m.add(f,"esriCTTableHeaderTitle "),a.hasOwnProperty("headerIcon")&&m.add(d,"esriCTTableHeaderIcon "+a.headerIcon));var l=h.create("div",{"class":"esriCTPriorityColumnParentContainer"}),g=h.create("div",{"class":"esriCTPriorityColumnParentDiv"});g.appendChild(f);a.hasOwnProperty("headerIcon")&&
g.appendChild(d);d=h.create("div",{"class":"esriCTPriorityNumberDiv"});4===c&&(h.create("div",{"class":"esriCTPriorityOneDiv",innerHTML:this.nls.smartActionsPage.priorityOneText},d),h.create("div",{"class":"esriCTPriorityTwoDiv",innerHTML:this.nls.smartActionsPage.priorityTwoText},d),h.create("div",{"class":"esriCTPriorityThreeDiv",innerHTML:this.nls.smartActionsPage.priorityThreeText},d));0===c?this._addSearchControl(l):(l.appendChild(g),l.appendChild(d));e.appendChild(l);x.set(e,"width",a.width);
b.appendChild(e)},_addSearchControl:function(a){var b=new z({trim:!0,placeHolder:this.nls.actionPage.searchPlaceHolder,intermediateChanges:!0},h.create("div",{},a));x.set(b.domNode,"width","350px");this.own(r(b,"change",g.hitch(this,this._searchTextUpdated)));a=h.create("div",{"class":"esriCTExpandAllNode"},a);this._expandAllCheckBox=new L({"class":"switch-toggle",checked:!1},h.create("div",{},a));h.create("label",{innerHTML:this.nls.actionPage.expandAllLabel},a);this.own(r(this._expandAllCheckBox,
"change",g.hitch(this,function(a){a?(a=n(".esriCTToggleLayerIcon.esriCTToggleLayerCollapsed.esriCTToggleLayerExpanded",this.layerAndFieldsMainDiv))&&0<a.length&&k.forEach(a,function(a){a.click()}):(a=n(".esriCTToggleLayerIcon.esriCTToggleLayerCollapsed",this.layerAndFieldsMainDiv))&&0<a.length&&k.forEach(a,function(a){m.contains(a,"esriCTToggleLayerExpanded")||a.click()})})))},_searchTextUpdated:function(a){var b;b=a.toLowerCase();if(""!==b){a=n("[searchstring]",this.tableParentContainer);b=n("tr[searchstring^\x3d'"+
b+"']",this.tableParentContainer);a.style("display","none");a.removeClass("esriCTNotFilteredBySearch");a.addClass("esriCTFilteredBySearch");b.style("display","");b.replaceClass("esriCTNotFilteredBySearch","esriCTFilteredBySearch");a=this.appliedOn;for(var c in a){var d,e,f;if(0<Object.keys(a[c]).length){b=n("[layermaindivid \x3d '"+c+"']",this.tableParentContainer);d=n("[layerid\x3d'"+c+"']",this.tableParentContainer);e=!0;for(f=0;f<d.length;f++)if(m.contains(d[f],"esriCTNotFilteredBySearch")){e=
!1;break}e?b.style("display","none"):b.style("display","")}}}else n("[layermaindivid]",this.tableParentContainer).style("display",""),n("[searchstring]",this.tableParentContainer).style("display",""),n("[searchstring]",this.tableParentContainer).removeClass("esriCTFilteredBySearch"),n("[searchstring]",this.tableParentContainer).addClass("esriCTNotFilteredBySearch")},_createHeaders:function(a){var b,c;c=[{title:"",icon:"",width:"41%"},{title:this.nls.actionPage.actions.hide,width:"13%",headerIcon:"esriCTHide"},
{title:this.nls.actionPage.actions.required,width:"13%",headerIcon:"esriCTRequired"},{title:this.nls.actionPage.actions.disabled,width:"13%",headerIcon:"esriCTDisabled"},{title:this.nls.smartActionsPage.priorityColumnText,icon:"",width:"20%"}];b=h.create("tr");m.add(b,"esriCTTableRow");k.forEach(c,g.hitch(this,function(a,c){this._createHeaderObj(a,b,c)}));a.appendChild(b)},_setMaxWidth:function(){var a=n(".esriCTTableHeaderTitle");k.forEach(a,g.hitch(this,function(a){var b=x.getComputedStyle(a).width;
x.set(a,"max-width",b)}))},_createPriorityIcons:function(a,b){var c=b.Priority;a=h.create("td",{},a);var d=h.create("div",{"class":"esriCTPriorityIconMainDiv"},a);k.forEach(c,g.hitch(this,function(a){h.create("div",{"class":"esriCTPriorityIcons esriCT"+a,title:this.nls.actionPage.actions[a.toLowerCase()]},d)}));c=h.create("div",{"class":"jimu-icon jimu-icon-edit esriCTPriorityEditIcon",title:this.nls.smartActionsPage.priorityPopupTitle},d);this.own(r(c,"click",g.hitch(this,function(a){this._createPriorityTable(a.currentTarget.parentNode);
this._createPriorityPopup(a.currentTarget.parentNode,b)})))},_createPriorityTable:function(a){this._priorityTable=new K({fields:[{name:"priorityName",title:this.nls.smartActionsPage.priorityPopupColumnTitle,type:"empty",width:"80%"},{name:"actions",title:this.nls.intersectionPage.actionsText,type:"actions",width:"20%",actions:["up","down"],"class":"actions"}],selectable:!1});this._priorityTable.startup();this._populatePriorityTable(a)},_getExistingPriority:function(a){var b={esriCTHide:"Hide",esriCTRequired:"Required",
esriCTDisabled:"Disabled"},c=[];k.forEach(a.childNodes,g.hitch(this,function(a,e){if(3>e)for(var d in b)m.contains(a,d)&&c.push(b[d])}));return c},_populatePriorityTable:function(a){a=this._getExistingPriority(a);k.forEach(a,g.hitch(this,function(a){var b=h.create("div",{innerHTML:this.nls.actionPage.actions[a.toLowerCase()],title:this.nls.actionPage.actions[a.toLowerCase()]});m.add(b,"esriCTTablePriorityTitle");q.set(b,"priority",a);var d=h.create("div",{title:this.nls.actionPage.actions[a.toLowerCase()]});
m.add(d,"esriCTPriorityPopupIcon esriCT"+a);a=this._priorityTable.addRow({}).tr;a=n(".simple-table-cell",a)[0];a.appendChild(d);a.appendChild(b)}))},_fetchPriority:function(){var a=this._priorityTable.getRows(),b=[];k.forEach(a,g.hitch(this,function(a){b.push(q.get(a.childNodes[0].childNodes[1],"priority"))}));return b},_changePriority:function(a,b){k.forEach(a,g.hitch(this,function(a,d){k.forEach(b.childNodes,g.hitch(this,function(b,c){d===c&&(k.forEach(["Hide","Required","Disabled"],g.hitch(this,
function(a){m.remove(b,"esriCT"+a)})),m.add(b,"esriCT"+a),q.set(b,"title",this.nls.actionPage.actions[a.toLowerCase()]))}))}))},_createPriorityPopup:function(a,b){var c=new A({titleLabel:this.nls.smartActionsPage.priorityPopupTitle,width:450,maxHeight:445,autoHeight:!0,content:this._priorityTable,"class":this.baseClass,buttons:[{label:this.nls.ok,onClick:g.hitch(this,function(){var d=this._fetchPriority();this._changePriority(d,a);b.Priority=d;c.close()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],
onClick:g.hitch(this,function(){c.close()})}],onClose:g.hitch(this,function(){})})},_createLayerName:function(a,b){var c=b,d=h.create("td"),e=h.create("div",{},d);this._jimuLayerInfos.getLayerInfoById(b)?c=this._jimuLayerInfos.getLayerInfoById(b).layerObject.name:this._jimuLayerInfos.getTableInfoById(b)&&(c=this._jimuLayerInfos.getTableInfoById(b).layerObject.name);var f=h.create("div",{"class":"esriCTToggleLayerIcon esriCTToggleLayerCollapsed esriCTToggleLayerExpanded",style:{"margin-top":"5px"}},
e);h.create("div",{"class":"esriCTLayerTitle",innerHTML:c},e);q.set(f,"rootnodelayerid",b);this.own(r(f,"click",g.hitch(this,function(a){m.toggle(a.currentTarget,"esriCTToggleLayerExpanded");m.contains(a.currentTarget,"esriCTToggleLayerExpanded")&&this._expandAllCheckBox.set("checked",!1,!1);a=q.get(a.currentTarget,"rootnodelayerid");n('[layerid\x3d"'+a+'"]').toggleClass("esriCTHidden")})));a.appendChild(d)},_createFieldNameTd:function(a,b){var c=h.create("td",{innerHTML:b,"class":"esriCTLayerFields"});
a.appendChild(c);q.set(a,"searchstring",b.toLowerCase())},_addRows:function(a,b){var c=b.layerDetails;b=b.fieldLabels;var d=[],e;for(e in c){var f=c[e],l=h.create("tr",{"class":"esriCTLayerNameRow"});this._createLayerName(l,e);q.set(l,"layermaindivid",e);a.appendChild(l);for(var p in f){l=h.create("tr",{"class":"esriCTLayerFieldRow esriCTHidden"});q.set(l,"layerid",e);q.set(l,"field",p);this._createFieldNameTd(l,b[e][p]);var v={layerid:e,field:p,action:"Hide"},u="";f[p].ExistingExpressions.hasOwnProperty("Hide")&&
(u=f[p].ExistingExpressions.Hide);this._createCheckBox(l,v,f[p].Hide,u);v.action="Required";u="";f[p].ExistingExpressions.hasOwnProperty("Required")&&(u=f[p].ExistingExpressions.Required);this._createCheckBox(l,v,f[p].Required,u);v.action="Disabled";u="";f[p].ExistingExpressions.hasOwnProperty("Disabled")&&(u=f[p].ExistingExpressions.Disabled);this._createCheckBox(l,v,f[p].Disabled,u);-1===d.indexOf(e)&&(f[p].Hide||f[p].Required||f[p].Disabled)&&d.push(e);this._createPriorityIcons(l,f[p]);a.appendChild(l)}}0<
d.length&&setTimeout(g.hitch(this,function(){k.forEach(d,function(a){n('[rootnodelayerid\x3d"'+a+'"]').toggleClass("esriCTToggleLayerExpanded");n('[layerid\x3d"'+a+'"]').toggleClass("esriCTHidden")})}),100)},_createCheckBox:function(a,b,c,d){var e=h.create("td");m.add(e,"esriCTCheckBoxTD");var f=h.create("div");c&&d&&(c=!1);var l=h.create("div");m.add(l,"esriCTCheckBoxMainDiv");var g=h.create("div");c=new B({checked:c},g);q.set(g,"action",b.action);var v=this.appliedOn[b.layerid][b.field];this.own(r(c,
"change",function(a){var b=q.get(this.domNode,"action");v[b]=a}));l.appendChild(g);f.appendChild(l);d&&(b=h.create("div",{title:d}),m.add(b,"esriCTExistingExpressionDiv"),f.appendChild(b));e.appendChild(f);a.appendChild(e)},_createTable:function(a){var b=h.create("table");m.add(b,"esriCTTableMainNode");this._createHeaders(b);this.tableParentContainer.appendChild(b);(a=this._createLayerDetails(g.clone(a)))&&a.layerDetails&&a.fieldLabels&&(this.appliedOn=a.layerDetails,this._addRows(b,a))},_validateIfLayerHaveUsedFields:function(a,
b){var c;b&&(c=b.length,k.forEach(a,function(a){k.forEach(b,function(b){a.name===b.fieldObj.name&&a.type===b.fieldObj.type&&c--})},this));return 0===c?!0:!1},_mergeActions:function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d].filter&&b[d].actionName===a[c].actionName){a[c]=g.clone(b[d]);break}return a},_mergeFieldValidations:function(a){var b={};k.forEach(a,function(a){for(var c in a)b.hasOwnProperty(c)?b[c]=this._mergeActions(b[c],a[c]):b[c]=g.clone(a[c])},this);return b},_getLayersFieldValidations:function(a,
b,c){k.forEach(b,function(b){b.featureLayer&&b.featureLayer.id===c&&b.fieldValidations&&(a||(a=[]),a.push(b.fieldValidations));b.relationshipInfos&&(a=this._getLayersFieldValidations(a,b.relationshipInfos,c))},this);return a},_getPartsInExpression:function(a,b){b&&k.forEach(b,g.hitch(this,function(b){b.parts?this._getPartsInExpression(a,b.parts):a.push(b)}));return a},_createLayerDetails:function(a){var b,c,d;c=null;this.filterInfo&&this.filterInfo.filter&&(b=this._getPartsInExpression([],this.filterInfo.filter.parts));
c={};d={};k.forEach(this._totalLayers,function(e){if(!e.isTable||e.isTable&&0<e.layerObject.relationships.length){var f,g,h=[];f=!1;g={};f=this._jimuLayerInfos.getLayerOrTableInfoById(e.id);g.allFields=f.layerObject.fields;f&&(f=this.editUtils.getConfigInfo(f,{}),g.fieldInfos=f.fieldInfos);f=this._validateIfLayerHaveUsedFields(g.allFields,b);g&&g.fieldInfos&&(f||!b)&&(h=this._getLayersFieldValidations(h,this._configInfos,e.id),g.fieldValidations=this._mergeFieldValidations(h),c[e.id]={},d[e.id]={},
k.forEach(g.fieldInfos,function(b){var f;f=O.getDefaultPortalFieldInfo(b);"esriFieldTypeGeometry"!==b.type&&"esriFieldTypeOID"!==b.type&&"esriFieldTypeBlob"!==b.type&&"esriFieldTypeGlobalID"!==b.type&&"esriFieldTypeRaster"!==b.type&&"esriFieldTypeXML"!==b.type&&(d[e.id][b.name]=f.label,c[e.id][b.name]=a&&a[e.id]&&a[e.id][b.name]?a[e.id][b.name]:{Hide:!1,Required:!1,Disabled:!1},g.fieldValidations&&g.fieldValidations[b.name]?(f=this._getPriorites(g.fieldValidations[b.name]),c[e.id][b.name].Priority=
f.Priority,c[e.id][b.name].ExistingExpressions=f.ExistingExpressions):(c[e.id][b.name].Priority=["Hide","Required","Disabled"],c[e.id][b.name].ExistingExpressions=[]))},this))}},this);return{layerDetails:c,fieldLabels:d}},_getPriorites:function(a){var b=[],c={};k.forEach(a,function(a){b.push(a.actionName);a.filter&&a.filter.displaySQL&&(!a.filter.hasOwnProperty("smartActionGroupName")||!this.prevName||a.filter.hasOwnProperty("smartActionGroupName")&&this.prevName&&this.prevName!==a.filter.smartActionGroupName)&&
(c[a.actionName]=a.filter.displaySQL)},this);return{Priority:b,ExistingExpressions:c}},_getVaidationForAction:function(a,b){var c=null;k.some(a,function(a){if(a.actionName===b&&a.filter&&a.filter.displaySQL)return c=a,!0});return c},_applysettingsToField:function(a,b){var c,d;d=[];d=this._getLayersFieldValidations(d,this._configInfos,a);c=b.appliedOn[a];for(var e=0;e<d.length;e++){var f=d[e];if(f)for(var h in c){for(var k=c[h],m=[],n=!1,q=0;q<k.Priority.length;q++){var r=k.Priority[q],t={};t.actionName=
r;t.submitWhenHidden=!1;if(k[r])n=!0,"Hide"===r&&(t.submitWhenHidden=b.submitWhenHidden),t.expression=b.filterInfo.expression,t.filter=g.clone(b.filterInfo).filter,t.filter.smartActionGroupName=b.name,this._removeSettingsFromOtherGroups(b.name,a,h,r);else if(f&&f[h]){var w=this._getVaidationForAction(f[h],r);w&&w.filter&&!k[r]&&w.filter.hasOwnProperty("smartActionGroupName")&&w.filter.smartActionGroupName===this.prevName?n=!0:w&&(t.expression=w.filter.expr,t.filter=w.filter)}m.push(t)}n&&(f||(f={}),
f[h]=m)}}},_removePrevSettingsFromLayerFields:function(a){var b=[];if(b=this._getLayersFieldValidations(b,this._configInfos,a))for(var c=0;c<b.length;c++)if(a=b[c])for(var d in a)a&&a[d]&&k.forEach(a[d],function(a){a&&a.filter&&a.filter.hasOwnProperty("smartActionGroupName")&&a.filter.smartActionGroupName===this.prevName&&(a.submitWhenHidden=!1,a.hasOwnProperty("expression")&&delete a.expression,delete a.filter)},this)},_removeSettingsFromOtherGroups:function(a,b,c,d){var e;if(this.existingGroups)for(var f in this.existingGroups)f!==
a&&f!==this.prevName&&(e=this.existingGroups[f].appliedOn)&&e.hasOwnProperty(b)&&e[b].hasOwnProperty(c)&&e[b][c].hasOwnProperty(d)&&(e[b][c][d]=!1)},_applySettingsInLayer:function(a){for(var b in a.appliedOn){var c;this._prevAppliedOnLayers&&-1<this._prevAppliedOnLayers.indexOf(b)&&(c=this._prevAppliedOnLayers.indexOf(b),this._prevAppliedOnLayers.splice(c,1));this._applysettingsToField(b,a)}this.deleteGroup()},deleteGroup:function(){this._prevAppliedOnLayers&&k.forEach(this._prevAppliedOnLayers,function(a){this._removePrevSettingsFromLayerFields(a)},
this)}})});