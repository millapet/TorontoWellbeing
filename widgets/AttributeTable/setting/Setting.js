// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),function(d,n,t,r,h,c,k,x,y,v,g,a,p,f,w){function z(e,b){if(!e||!e.length)return b||[];if(!b||!b.length)return e;for(var a=[],m=0,q=e.length;m<q;m++)for(var f=e[m],
p=0,g=b.length;p<g;p++){var w=b[p];if(w.name===f.name){w.alias!==f.alias&&(f.alias=w.alias);a.push(f);break}}return a}c.readLayerInfosObj=function(e){return t.getInstance(e,e.itemInfo)};c.readLayerInfosFromMap=function(e,b,a){var m=new r;t.getInstance(e,e.itemInfo).then(d.hitch(this,function(e){var l=[];b?e.traversalLayerInfosOfWebmap(function(b){l.push(b)}):e.traversal(function(b){l.push(b)});if(a){var q=[],f=e.getMapNotesLayerInfoArray();n.forEach(f,function(b){q.push(b.id);b.traversal(function(b){q.push(b.id)})});
l=n.filter(l,function(b){return-1===q.indexOf(b.id)})}e=e.getTableInfoArray();l=l.concat(e);m.resolve(l)}),d.hitch(this,function(b){console.error(b);m.reject(b)}));return m.promise};c.generateColumnsFromFields=function(e,b,a,m,q,f,g,k){function l(b){var e=b.name;if(u&&v.isDefined(u.fieldInfos))for(var a=0,l=u.fieldInfos.length;a<l;a++){var m=u.fieldInfos[a];if(m.fieldName===e&&m.format)return m.format}return(b=p.getDefaultPortalFieldInfo(b))&&b.format?b.format:null}var u=b.getPopupInfo()||b.getPopupInfoFromLayerObject&&
b.getPopupInfoFromLayerObject(),h={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(b,e,a){a.setAttribute("role","button");a.setAttribute("title",w.selectionHandleLabel)}}};n.forEach(a,d.hitch(c,function(a,u,w){u="field"+u;var z=!!a.domain,y="esriFieldTypeDate"===a.type,B=m&&a.name===m,A="esriFieldTypeDouble"===a.type||"esriFieldTypeSingle"===a.type||"esriFieldTypeInteger"===a.type||"esriFieldTypeSmallInteger"===
a.type,x="esriFieldTypeString"===a.type,C=0===a.name.indexOf("expression/"),r=a.alias||a.name,t;t=1===w.length?!1:e&&e[u]?e[u].hidden:a?!a.show&&v.isDefined(a.show):!1;h[u]={label:r,className:u,hidden:t,unhidable:1===w.length?!1:!a.show&&v.isDefined(a.show)&&a._pk,field:a.name,sortable:!1,_cache:{sortable:!!f,statistics:g&&!z&&A}};x?h[u].formatter=d.hitch(c,c.urlFormatter):y?h[u].formatter=d.hitch(c,c.dateFormatter,l(a)):A&&(h[u].formatter=d.hitch(c,c.numberFormatter,l(a)));z?h[u].get=d.hitch(c,function(b,
a,e){return this.getCodeValue(b,a.name,e)},k,a):B?h[u].get=d.hitch(c,function(b,a,e){return this.getTypeName(e[b.name],a)},a,q):C?(w=this.arcade.getExpressionInfosFromLayerInfo(b),z=p.getFeatureLayerDefinition(k),h[u]._cache.sortable=!1,h[u].get=d.hitch(c,function(b,a,e,l){return this.arcade.getAttributes(l,b,e)[a.name]||""},w,a,z)):z||y||B||C||(h[u].get=d.hitch(c,function(b,a,e,l,m){var q=null;e&&l&&0<l.length&&(l=(l=n.filter(l,d.hitch(c,function(b){return b.id===m[e]})))&&l[0]||null)&&l.domains&&
l.domains[a.name]&&l.domains[a.name].codedValues&&(q=this.getCodeValue(b,a.name,m));return(b=null!==q?q:m[a.name])||isFinite(b)?b:""},k,a,m,q))}));return h};c.getTypeName=function(a,b){return p.fieldFormatter.getTypeName(a,b)};c.getCodeValue=function(a,b,l){return(a=p.getDisplayValueForCodedValueOrSubtype(a,b,l))&&a.isCodedValueOrSubtype?a.displayValue||"":""};c.urlFormatter=function(a){return p.fieldFormatter.getFormattedUrl(a)};c.dateFormatter=function(a,b){return p.fieldFormatter.getFormattedDate(b,
a)};c.numberFormatter=function(a,b){return p.fieldFormatter.getFormattedNumber(b,a)};c.readLayerObjectsFromMap=function(a,b,l){var e=new r,q=[];this.readLayerInfosFromMap(a,b,l).then(d.hitch(this,function(b){n.forEach(b,d.hitch(this,function(b){q.push(b.getLayerObject())}));h(q).then(d.hitch(this,function(b){e.resolve(b)}),d.hitch(this,function(b){e.reject(b);console.error(b)}))}),d.hitch(this,function(b){e.reject(b)}));return e.promise};c.readSupportTableInfoFromLayerInfos=function(a){var b=new r,
e=[];n.forEach(a,d.hitch(this,function(b){e.push(b.getSupportTableInfo())}));h(e).then(d.hitch(this,function(e){e=d.clone(e);n.forEach(e,function(b,e){b.id=a[e].id});b.resolve(e)}),function(a){b.reject(a)});return b.promise};c.readConfigLayerInfosFromMap=function(a,b,l){var e=new r,q=[];this.readLayerInfosFromMap(a,b,l).then(d.hitch(this,function(b){var a=[];n.forEach(b,function(b){q.push(b.getSupportTableInfo())});h(q).then(d.hitch(this,function(l){n.forEach(l,d.hitch(this,function(e,l){e.isSupportedLayer&&
(b[l].name=b[l].title,a.push(b[l]))}));e.resolve(a)}),d.hitch(this,function(b){e.reject(b)}))}),d.hitch(this,function(b){e.reject(b)}));return e.promise};c.getConfigInfosFromLayerInfos=function(a){return n.map(a,function(b){return c.getConfigInfoFromLayerInfo(b)})};c.getConfigInfoFromLayerInfo=function(a){var b={};b.name=a.name||a.title;b.id=a.id;b.show=a.isShowInMap();b.layer={url:a.getUrl()};var e=a.getPopupInfo();e&&!e.description&&(b.layer.fields=n.map(e.fieldInfos,function(b){return{name:b.fieldName,
alias:b.label,show:b.visible,format:b.format}}),a=d.getObject("layerObject.fields",!1,a),b.layer.fields=z(b.layer.fields,a),n.some(b.layer.fields,function(b){return b.show})||(b.layer.fields&&0<b.layer.fields.length?b.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return b};c.generateCacheStore=function(a,b,l,f,q){a=new g({layer:a,objectIds:a._objectIds||null,totalCount:b,batchCount:l,where:f||"1\x3d1",spatialFilter:q});b=new y;return new x(a,b,{})};c.generateMemoryStore=function(a,
b){return new k(new y({data:a||[],idProperty:b}))};c.merge=function(a,b,l,f){for(var e=n.map(b,function(b){return b[l]}),m=0,p=a.length;m<p;m++){var g=e.indexOf(a[m][l]);-1<g&&f(a[m],b[g])}};c.syncOrderWith=function(a,b,l){function e(b,a){return n.map(b,function(b){return b[a]})}if(!d.isArray(b)||!l)return a;for(var q=e(a,l),f=[],p=0,g=b.length;p<g;p++){var w=q.indexOf(b[p][l]);-1<w&&(f=f.concat(a.splice(w,1)),q=e(a,l))}return f.concat(a)};c.arcade={};c.arcade.getExpressionInfosFromLayer=function(e,
b){e=a.readExprInfo.getArcadeProfilesByType(e,b,"infoTemplate");return 0<e.length&&e[0].expressionInfos?e[0].expressionInfos:[]};c.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};c.arcade.getAttributes=function(e,b,l){var m=new f(e.geometry,null,e);return a.customExpr.getAttributesFromCustomArcadeExpr(b,m,l)||e};c.arcade.appendArcadeExpressionsToFields=function(a,b){if(a){b=c.arcade.getExpressionInfosFromLayerInfo(b);if(0<b.length){var l=/^expression\//;
n.forEach(b,function(b){n.some(a,function(a){if(l.test(a.name))return a=a.name.substr(11),b.name===a})||a.push({name:"expression/"+b.name,alias:b.title,show:!0})})}return a}};c.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")};c.arcade.parseArcadeExpressions=function(e){return a.InfoTemplate._parseArcadeExpressions(e)};c.getSortbyFields=function(a,b){a=a&&a.get("sort")||[];b=b&&b.objectIdField;0<a.length?a=n.map(a,function(a){return a.attribute+
" "+(a.descending?"DESC":"ASC")}):b&&a.push(b+" ASC");return a}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(d,n){var t=function(r,h,c){c=c||{};return d.delegate(r,{query:function(k,d){k=r.query(k,d);k.forEach(function(k){c.isLoaded&&!c.isLoaded(k)||h.put(k)});return k},queryEngine:r.queryEngine||h.queryEngine,get:function(k,c){return n(h.get(k),function(d){return d||n(r.get(k,c),function(c){c&&h.put(c,{id:k});return c})})},add:function(k,c){return n(r.add(k,c),function(d){h.add(d&&
"object"==typeof d?d:k,c);return d})},put:function(c,d){h.remove(d&&d.id||this.getIdentity(c));return n(r.put(c,d),function(k){h.put(k&&"object"==typeof k?k:c,d);return k})},remove:function(c,d){return n(r.remove(c,d),function(k){return h.remove(c,d)})},evict:function(c){return h.remove(c)}})};d.setObject("dojo.store.Cache",t);return t})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),
function(d,n,t,r,h,c){return d(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(c){d.safeMixin(this,c);this.data=[];this._entityData=[];this.layer=c.layer;this.objectIds=c.objectIds;this.where=c.where;this.orderByFields=c.orderByFields;this.totalCount=c.totalCount;this.batchCount=c.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=c.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new h(this.layer.url))},get:function(c){return this.data[c]},
getIdentity:function(c){return c[this.idProperty]},query:function(d,h){var k=new r,v=h&&h.start||0,g=h._export_count||this.batchCount,a=null;"function"===typeof d?a=d(this._entityData):"[object Array]"===Object.prototype.toString.call(d)&&(a=d);this.objectIds?(a=a?a:this.objectIds,k.objectIds=a.length>=v+this.batchCount?a.slice(v,v+g):a.slice(v)):(a&&0<a.length?k.objectIds=a.length>=v+this.batchCount?a.slice(v,v+g):a.slice(v):(k.start=v,k.num=g,k.where=this.where,k.geometry=this.spatialFilter,k.spatialRelationship=
r.SPATIAL_REL_INTERSECTS),(d=h.sort)&&0<d.length&&(d=t.map(d,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}),k.orderByFields=d));k.returnGeometry="esriGeometryPoint"===this.layer.geometryType;k.outFields=["*"];var p=this.totalCount;d=null;d=!k.where;if(!(k.objectIds&&0<k.objectIds.length)&&d)return new c([]);d=this.queryTask?this.queryTask.execute(k):this.layer.queryFeatures(k);d.total=d.then(n.hitch(this,function(a){var f=0,c=this.layer.objectIdField;if(this.objectIds){if(!c)for(f=
0;f<a.fields.length;f++)if("esriFieldTypeOID"===a.fields[f].type){c=a.fields[f].name;break}for(var e={},f=0;f<a.features.length;f++)e[a.features[f].attributes[c]]=a.features[f];a.features=t.map(k.objectIds,function(a){return e[a]})}for(f=0;f<a.features.length;f++)if(a.features[f]){var b=a.features[f];a.features[f]=n.mixin(n.clone(b.attributes),{geometry:b.geometry});this.data[a.features[f][c]]=a.features[f];this._entityData.push(a.features[f])}a=a.features;return p}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");
return 0});return new c(d)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(d,n,t,r){var h=function(c){function k(d){c[d]||(c[d]=function(){var k=arguments;return r.when(c,function(c){Array.prototype.unshift.call(k,c.features||c);return h(t[d].apply(t,k))})})}if(!c)return c;c.then&&(c=n.delegate(c));c.total||(c.total=r.when(c,function(c){return d._isDefined(c.total)?
c.total:c.length||0}));k("forEach");k("filter");k("map");k("some");k("every");return c};return h})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),function(d,n,t,r,h,c,k,x,y,v){var g={readExprInfo:{}};g.readExprInfo.getArcadeProfilesByType=function(a,c,f){a={map:a,layer:c};return"render"===f?g.readExprInfo._getArcadeRender(a):
"label"===f?g.readExprInfo._getArcadeLabel(a):"infoTemplate"===f?g.readExprInfo._getArcadeInfoTemplate(a):g.readExprInfo._getAllArcade(a)};g.readExprInfo._getArcadeRender=function(a){return g.readExprInfo._lookupArcadeRender({layers:g.readExprInfo._checkPassInLayer(a)})};g.readExprInfo._getArcadeInfoTemplate=function(a){return g.readExprInfo._lookupArcadeInfoTemplate({layers:g.readExprInfo._checkPassInLayer(a)})};g.readExprInfo._getArcadeLabel=function(a){return g.readExprInfo._lookupArcadeLabel({layers:g.readExprInfo._checkPassInLayer(a)})};
g.readExprInfo._getAllArcade=function(a){var c=g.readExprInfo._getArcadeRender(a),f=g.readExprInfo._getArcadeInfoTemplate(a);a=g.readExprInfo._getArcadeLabel(a);return{render:c,infoTemplate:f,label:a}};g.readExprInfo._checkPassInLayer=function(a){var c=[];return c="undefined"!==typeof a?"undefined"!==typeof a.layer?null!==a.layer&&""!==a.layer?g.readExprInfo._getAllMapLayers(a):g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers()};g.readExprInfo._getAllMapLayers=
function(a){var c="",f=[],d=v.getInstance();a&&a.layer&&(c=a.layer.id);""!==c?(a=d.getNodeById(c))&&f.push(a._layerInfo.layerObject):d.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&f.push(a._layerInfo.layerObject):f.push(a._layerInfo.layerObject)});return f};g.readExprInfo._lookupArcadeRender=function(a){var c=[];0<a.layers.length&&d.forEach(a.layers,n.hitch(this,function(a){var f={};if("undefined"!==typeof a.renderer){var d=
a.renderer;"undefined"!==typeof d.valueExpression&&(f.layer=a.id,f.valueExpression=d.valueExpression,f.valueExpressionTitle=d.valueExpressionTitle,"undefined"!==typeof d.values&&(f.values=d.values),"undefined"!==typeof d.visualVariables&&(f.visualVariables=d.visualVariables));1<Object.keys(f).length&&f.constructor===Object?c.push(f):c.push({layer:a.id,valueExpression:null,valueExpressionTitle:null,values:null,visualVariables:null})}}));return c};g.readExprInfo._lookupArcadeInfoTemplate=function(a){var c=
[];0<a.layers.length&&d.forEach(a.layers,n.hitch(this,function(a){var f={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(f.layer=a.id,f.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var d in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(d)&&"undefined"!==typeof a.infoTemplates[d].infoTemplate.info.expressionInfos){var e=a.infoTemplates[d].infoTemplate;
0<e.info.expressionInfos.length&&(f.layer=a.id,f.expressionInfos=e.info.expressionInfos)}1<Object.keys(f).length&&f.constructor===Object?c.push(f):c.push({layer:a.id,expressionInfos:null})}));return c};g.readExprInfo._lookupArcadeLabel=function(a){var c=[];0<a.layers.length&&d.forEach(a.layers,n.hitch(this,function(a){var f={};"undefined"!==typeof a.labelingInfo&&d.forEach(a.labelingInfo,n.hitch(this,function(c){"undefined"!==typeof c.name&&(f.layer=a.id,f.name=c.name,f.labelingInfo=c,f.expression=
c.labelExpressionInfo.expression)}));1<Object.keys(f).length&&f.constructor===Object?c.push(f):c.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return c};g.customExpr={};g.customExpr.getAttributesFromCustomArcadeExpr=function(a,c,f){a=g.InfoTemplate._parseArcadeExpressions(a);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(c,a,f)};g.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(a,c,f){var d=[],p;for(p in c)d.push(c[p]);c=g.InfoTemplate._parseArcadeExpressions(a);
a=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a);a.relationships=null;a.parsedExpressions=c;var e=new t;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,a,f).then(function(a){e.resolve(a)});return e};g.InfoTemplate={};g.InfoTemplate.getAttributesFromInfoTemplate=function(a,c,f){var d={fields:[]};c.layerObject&&c.layerObject.fields&&(d.fields=c.layerObject.fields);a=g.readExprInfo.getArcadeProfilesByType(a,c,"infoTemplate")[0].expressionInfos;if(!a)return f.attributes;a=g.InfoTemplate._parseArcadeExpressions(a);
return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(f,a,d)};g.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(a,c,f){var d={fields:[]};c.layerObject&&c.layerObject.fields&&(d.fields=c.layerObject.fields);var h=[],e;for(e in f)h.push(f[e]);a=g.readExprInfo.getArcadeProfilesByType(a,c,"infoTemplate")[0].expressionInfos;var b=new t;if(!a)return b.resolve([]),b;f=g.InfoTemplate._parseArcadeExpressions(a);e=null;e=c.getPopupInfo().description;null!==e?(e=g.InfoTemplate._convertPopupDescToFieldNamesArray(e),
e.relationships=g.InfoTemplate._getRelationshipQueries(c)):(e=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a),e.relationships=null);e.parsedExpressions=f;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(h,e,d).then(function(a){b.resolve(a)});return b};g.InfoTemplate._getRelationshipQueries=function(a){var c=!1,f={},g=/\d+/,h;if(h=a.getPopupInfo().description.match(/\{relationships\/\d+\//gm))c=!0,d.forEach(h,function(c){var b=c.match(g)[0];f.hasOwnProperty(b)||(c=new x,c.outFields=["*"],
c.relationshipId=b,c.returnGeometry=!1,f[b]={operLayer:a,relatedQuery:c})});return c?f:null};g.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(a){var c=[],f;for(f in a)c.push("${expression/"+a[f].name+"}");return c};g.InfoTemplate._convertPopupDescToFieldNamesArray=function(a){a=g.InfoTemplate._convertEndParasToEOLs(a);a=g.InfoTemplate._convertBreaksToEOLs(a);a=g.InfoTemplate._sanitizeNoTags(a).trim();a=a.replace(/\{/gi,"${");a=a.replace(/\u00a0/gi," ");a=a.split("\n");return a=d.map(a,
function(a){return a.trim()})};g.InfoTemplate._sanitizeNoTags=function(a){var c;c=y.sanitizeHTML(a);a=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var f;do f=c,c=c.replace(a,"");while(c!==f);return c=c.replace(/</g,"\x26lt;")};g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(a,c,f){var k=new t,p=[],e=[],b=0;c.relationships?(d.forEach(a,function(a){g.InfoTemplate._objEach(c.relationships,
function(b,l){var q=new t,m=b.relatedQuery,k;e.push(q);k=a.attributes[b.operLayer.layerObject.objectIdField];m.objectIds=[k];b.operLayer.layerObject.queryRelatedFeatures(m,function(b){var e=[];b[k]&&b[k].features&&(b=b[k].features,d.forEach(b,function(b){var q=[],m,u,k;m=a.attributes;u="relationships/"+l+"/";g.InfoTemplate._objEach(b.attributes,function(a,b){k=u+b;m[k]=a});d.forEach(c,function(b){q.push(h.substitute(b,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,c.parsedExpressions,
f),g.InfoTemplate._useEmptyStringForNull))});e.push(q)}));q.resolve(e)})})}),r(e).then(function(a){d.forEach(a,function(a){d.forEach(a,function(a){++b;p.push(a)})});console.log(b+" related address features found");k.resolve(p)})):(d.forEach(a,function(a){var b=[];d.forEach(c,function(l){b.push(h.substitute(l,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,c.parsedExpressions,f),g.InfoTemplate._useEmptyStringForNull))});p.push(b)}),k.resolve(p));return k};g.InfoTemplate._parseArcadeExpressions=
function(a){var g;Array.isArray(a)&&0<a.length&&(g={},d.forEach(a,function(a){g[a.name]=c.parseScript(a.expression)}));return g};g.InfoTemplate._initArcadeContext=function(a,c){var f={vars:{}};f.vars.$feature=k.createFromGraphicLikeObject(a.geometry,a.attributes,c);return f};g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(a,d,f){var h,k;h=n.mixin({},a.attributes);if(d)for(k in a=g.InfoTemplate._initArcadeContext(a,f),d)f=c.executeScript(d[k],a),h["expression/"+k]=f?f.toString():
"";return h};g.InfoTemplate._convertEndParasToEOLs=function(a){var c=a;a=a.match(/<\/p>/gi);d.forEach(a,function(a){c=c.replace(a,"\n")});return c};g.InfoTemplate._convertBreaksToEOLs=function(a){var c=a;a=a.match(/<br\s*\/?>/gi);d.forEach(a,function(a){c=c.replace(a,"\n")});return c};g.InfoTemplate._useEmptyStringForNull=function(a){return a?a:""};g.InfoTemplate._objEach=function(a,c,d){for(var f in a)a.hasOwnProperty(f)&&c.call(d,a[f],f)};return g})},"widgets/AttributeTable/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/AttributeTable/setting/Setting.html":'\x3cdiv style\x3d"width:100%;"\x3e\r\n  \x3cdiv class\x3d"instruction"\x3e\r\n    \x3cp\x3e${nls.instruction}\x3c/p\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"check-syncwithlayers" data-dojo-attach-point\x3d"syncWithLayersCheck"\r\n    data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.syncWithLayers}"\x3e\x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"tableLayerInfos" class\x3d"table-layer-infos"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"table-options jimu-ellipsis"\x3e\r\n    \x3cul\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"exportcsv" checked\r\n        data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.exportCSV}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"expand" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.expand}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"filterByMapExtent" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.filterByExtent}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"textSelection" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.allowTextSelection}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n    \x3c/ul\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AttributeTable/setting/css/style.css":".jimu-widget-attributetable-setting{margin:0; padding:0; font-size:14px; width: 100%; height: 100%; position: relative; color: #596679;}.jimu-widget-attributetable-setting .instruction{font-size: 12px; margin-bottom: 10px;}.jimu-widget-attributetable-setting .check-syncwithlayers {margin-bottom: 10px; padding-left: 8px; padding-right: 8px;}.jimu-widget-attributetable-setting .show{width: 120px;}.jimu-widget-attributetable-setting .symbol{width: 200px;}.jimu-widget-attributetable-setting .table-layer-infos{width: 100%; height: 240px;}.jimu-widget-attributetable-setting .table-options ul{list-style-type: none; padding: 0;}.jimu-widget-attributetable-setting .jimu-checkbox{margin-right: 20px;}.jimu-rtl .jimu-widget-attributetable-setting .jimu-checkbox{margin-left: 20px; margin-right: 0;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled {color: #e5e5e5;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled .checkbox{cursor: default;}.jimu-widget-attributetable-setting th.isDescending .jimu-checkbox {display: none;}.jimu-widget-attributetable-setting td.isDescending {text-align: center;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox {top: 5px; margin: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {background: transparent; background-image: url('images/order_up.svg'); width: 16px; height: 16px; background-repeat: no-repeat; background-position-x: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox.jimu-icon-checked {background-image: url('images/order_down.svg');}.jimu-rtl .jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {-webkit-transform: rotateY(180deg); transform: rotateY(180deg);}.jimu-widget-attributetable-setting .sortField .dijitSelect{height: 20px; background: #fff; margin: 5px 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-right-width: 0;}.jimu-rtl .jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-left-width: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonText{overflow: hidden; text-overflow: ellipsis; width: 90px;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitInputField{padding-top: 0; padding-bottom: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitArrowButton{background: #fff;}.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-right: 6px;}.jimu-rtl.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-left: 6px;}",
"*now":function(d){d(['dojo/i18n!*preload*widgets/AttributeTable/setting/nls/Setting*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/SimpleTable dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/Deferred dojo/promise/all dojo/query dijit/registry jimu/dijit/Popup jimu/dijit/Message jimu/dijit/CheckBox jimu/dijit/LoadingShelter ../utils".split(" "),function(d,n,t,r,h,c,k,x,y,v,g,a,p,f,w,z,e){return d([t,n],{baseClass:"jimu-widget-attributetable-setting",currentFieldTable:null,_allLayerFields:null,_layerInfos:null,_tableInfos:null,
_delayedLayerInfos:null,_delayedLayerInfosAfterInit:null,_unSpportQueryCampsite:null,startup:function(){this.inherited(arguments);this.config.layerInfos||(this.config.layerInfos=[]);this._allLayerFields=[];this._layerInfos=[];this._tableInfos=[];this._delayedLayerInfos=[];this._delayedLayerInfosAfterInit=[];this._unSpportQueryCampsite={};this.displayFieldsTable=new r({fields:[{name:"show",title:this.nls.show,width:"auto",type:"checkbox","class":"show"},{name:"label",title:this.nls.label,width:"60%",
type:"text"},{name:"url",title:this.nls.url,type:"text",hidden:!0},{name:"index",title:"index",type:"text",hidden:!0},{name:"sortField",title:this.nls.sortField,type:"dropdown",width:"130"},{name:"isDescending",title:"",width:"40",type:"checkbox","class":"sort-order"},{name:"actions",title:this.nls.actions,type:"actions",width:"20%",actions:["edit"],"class":"symbol"},{name:"showAttachments",title:"",type:"checkbox",hidden:!0}],selectable:!0,autoHeight:!1});this.displayFieldsTable.placeAt(this.tableLayerInfos);
c.setStyle(this.displayFieldsTable.domNode,{height:"100%"});this.shelter=new z({hidden:!0});this.shelter.placeAt(this.domNode.parentNode.parentNode||this.domNode);this.shelter.startup();this.shelter.show();e.readLayerInfosObj(this.map).then(h.hitch(this,function(a){this.own(a.on("layerInfosChanged",h.hitch(this,this.onLayerInfosChanged)));this.own(x(this.displayFieldsTable,"actions-edit",h.hitch(this,this.editFieldsClick)));this.own(x(this.displayFieldsTable,"row-click",h.hitch(this,this._verifiedOnShowClick)));
this.own(x(this.displayFieldsTable,"row-add",h.hitch(this,function(a){this._addTooltipToSortOrderNode(a)})));this.own(x(this.syncWithLayersCheck,"change",h.hitch(this,function(a){this._toggleTableShowOption(a)})));this.setConfig(this.config)}))},editFieldsClick:function(a){var b=g(".action-item-parent",a);if(b&&b.length)if(b=this.displayFieldsTable.getRowData(a),b.show){var c=parseInt(b.index,10);this.shelter.show();this._getLayerFields(c).then(h.hitch(this,function(b){this.openFieldsDialog(a,b,c)}),
h.hitch(this,function(a){console.error(a)})).always(h.hitch(this,function(){this.shelter.hide()}))}else var d=new f({message:this.nls.warning,buttons:[{label:this.nls.ok,onClick:h.hitch(this,function(){d.close()})}]})},_verifiedOnShowClick:function(a){var b=this.displayFieldsTable.getRowData(a),c=parseInt(b.index,10),d=null,d=this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?this.config.layerInfos[c]:this._layerInfos[c],c=-1<this._unSpportQueryCampsite.layerNames.indexOf(d.name||
d.title);b.show&&c&&(new f({message:this.nls.unsupportQueryWarning}),b.show=!1,this.displayFieldsTable.editRow(a,b))},_getLayerFields:function(a){return this._layerInfos[a].getLayerObject().then(h.hitch(this,function(b){var c=this._allLayerFields[a];b=k.map(b.fields,function(a){return{name:a.name,alias:a.alias,show:!0}});b=e.arcade.appendArcadeExpressionsToFields(b,this._layerInfos[a]);e.merge(b,c,"name",function(a,b){h.mixin(a,b)});return b=e.syncOrderWith(b,c,"name")}))},_addTooltipToSortOrderNode:function(b){var c=
g(".sort-order .jimu-checkbox",b)[0];b=a.byNode(c);var d=this.nls,e=function(a){c.title=a?d.sortOrderTooltips.toAscending:d.sortOrderTooltips.toDescending};b&&(this.own(x(b,"change",e)),e(b.checked))},openFieldsDialog:function(a,d,e){var b=!1,f=this._layerInfos[e];(f=f&&f.layerObject)&&(b=f.hasAttachments&&f.objectIdField);var f=c.create("div"),l=this._createFieldsTable(d,e);c.place(l.domNode,f);var g=null;b&&(g=new w({label:this.nls.showAttachments,style:"margin-top:10px;"}),d=this.displayFieldsTable.getRowData(a),
g.setValue(d.showAttachments),g.placeAt(f));this.currentFieldTable=l;d=600;g&&(d=640);var m=new p({titleLabel:this.nls.configureLayerFields,width:640,maxHeight:d,autoHeight:!0,content:f,buttons:[{label:this.nls.ok,onClick:h.hitch(this,function(){this._allLayerFields[e]=l.getData();var b=g?g.getValue():!1;this.displayFieldsTable.editRow(a,{showAttachments:b});m.close();m=null})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:h.hitch(this,function(){m.close();m=null})}],onClose:function(){m=
null}});l.startup()},_createFieldsTable:function(a){for(var b=null,c={fields:[{name:"show",title:this.nls.fieldVisibility,type:"checkbox","class":"show",onChange:h.hitch(this,function(a){var c=b.getData();!k.some(c,h.hitch(this,function(a){return a.show}))&&(new f({message:this.nls.fieldCheckWarning}),c=b.getRowData(a))&&(c.show=!0,b.editRow(a,c))})},{name:"name",title:this.nls.fieldName,type:"text"},{name:"alias",title:this.nls.fieldAlias,editable:!0,type:"text"},{name:"actions",title:this.nls.fieldActions,
type:"actions",actions:["up","down"],"class":"symbol"}],selectable:!0,autoHeight:!1,style:{height:"300px",maxHeight:"300px"}},b=new r(c),c=0;c<a.length;c++)a[c].show=void 0===a[c].show?!0:!!a[c].show,b.addRow(a[c]);return b},setConfig:function(a){this.config=a;this.displayFieldsTable.clear();this._allLayerFields=[];this._processTableData().then(h.hitch(this,function(a){this._init(a);this.shelter.hide()}),h.hitch(this,function(a){new f({message:a.message||a})}))},onLayerInfosChanged:function(a,c,d){"added"===
c&&d&&a&&d.getSupportTableInfo().then(h.hitch(this,function(a){a.isSupportedLayer&&(this._layerInfos&&0===this._layerInfos.length?this._delayedLayerInfos.push(d):this._layerInfos&&0<this._layerInfos.length&&!this._getLayerInfoById(d.id)&&(this._delayedLayerInfosAfterInit.push(d),this._processDelayedLayerInfosAfterInit(this._delayedLayerInfosAfterInit)))}))},_processDelayedLayerInfosAfterInit:function(a){for(var b=this._layerInfos.length,c=[],d=0;d<a.length;d++){var f=e.getConfigInfoFromLayerInfo(a[d]),
g={label:f.name||f.title,url:f.layer.url,index:""+(b+d),isDescending:!0,show:f.show};this._allLayerFields.push(f.layer.fields);this._layerInfos.push(a[d]);c.push(this._prepareSortField(g,d))}v(c).then(h.hitch(this,function(a){for(var b=0;b<a.length;b++)this._addRowToDisplayFieldsTable(a[b])}),h.hitch(this,function(a){console.error(a)}))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(k.forEach(this._delayedLayerInfos,h.hitch(this,function(a){this._getLayerInfoById(a.id)||
this._layerInfos.push(a)})),this._delayedLayerInfos=[])},_processTableData:function(){var a=new y;e.readConfigLayerInfosFromMap(this.map,!0,!0).then(h.hitch(this,function(b){this._layerInfos=b;this._processDelayedLayerInfos();e.readSupportTableInfoFromLayerInfos(this._layerInfos).then(h.hitch(this,function(c){this._tableInfos=c;this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?(c=e.getConfigInfosFromLayerInfos(this._layerInfos),e.merge(c,this.config.layerInfos,"id",h.hitch(this,
function(a,b){var c=this._getLayerInfoById(a.id);a.layer.fields=e.arcade.appendArcadeExpressionsToFields(a.layer.fields,c);a.show=b.show;a.showAttachments=b.showAttachments;a.sortField=b.sortField;a.isDescending=b.isDescending;a.layer.url=b.layer.url;h.getObject("layer.fields.length",!1,a)&&h.getObject("layer.fields.length",!1,b)?(e.merge(a.layer.fields,b.layer.fields,"name",function(a,b){h.mixin(a,b)}),a.layer.fields=e.syncOrderWith(a.layer.fields,b.layer.fields,"name")):a.layer.fields=b.layer.fields})),
this.config.layerInfos=c,this._unSpportQueryCampsite.fromConfig=!0,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this.config.layerInfos)):(this._unSpportQueryCampsite.fromConfig=!1,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this._layerInfos),c=e.getConfigInfosFromLayerInfos(b),c=k.map(c,h.hitch(this,function(a){var b=h.getObject("layer.fields",!1,a),c=this._getLayerInfoById(a.id);b&&(b=e.arcade.appendArcadeExpressionsToFields(a.layer.fields,
c),a.layer.fields=b);return a})));a.resolve(c)}),function(b){console.error(b);a.reject(b)})}),h.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_getUnsupportQueryLayerNames:function(a){var b=[];k.forEach(a,h.hitch(this,function(a){var c=this._getSupportTableInfoById(a.id);c&&!c.isSupportQuery&&b.push(a.name||a.title)}));return b},_init:function(a){for(var b=[],d=[],e=0;e<a.length;e++){var g=a[e].show&&this._getSupportTableInfoById(a[e].id).isSupportQuery,g={label:a[e].name||a[e].title,
url:a[e].layer.url,index:""+e,show:g,sorting:{fields:a[e].layer.fields,selectedField:a[e].sortField},isDescending:a[e].isDescending,showAttachments:!!a[e].showAttachments};this._allLayerFields.push(a[e].layer.fields);d.push(this._prepareSortField(g,e));this._unSpportQueryCampsite.fromConfig&&(g=(g=this._unSpportQueryCampsite.layerNames)&&-1<g.indexOf(a[e].name||a[e].title),a[e].show&&g&&b.push(a[e].name||a[e].title))}v(d).then(h.hitch(this,function(a){for(var b=0;b<a.length;b++)this._addRowToDisplayFieldsTable(a[b])}),
h.hitch(this,function(a){console.error(a)}));this._unSpportQueryCampsite.fromConfig&&0<b.length&&new f({message:this.nls.unsupportQueryLayers+"\x3cbr\x3e\x3cbr\x3e"+b.toString()});this.config.hideExportButton?this.exportcsv.uncheck():this.exportcsv.check();this.config.initiallyExpand?this.expand.check():this.expand.uncheck();this._canUseOpenAtStart()&&(this.openAtStart?this.expand.check():this.expand.uncheck(),this.expand.status=!1,c.addClass(this.expand.domNode,"disable-checkbox"));this.config.filterByMapExtent?
this.filterByMapExtent.check():this.filterByMapExtent.uncheck();this.config.allowTextSelection?this.textSelection.check():this.textSelection.uncheck();this.config.syncWithLayers?this.syncWithLayersCheck.check():this.syncWithLayersCheck.uncheck()},_addRowToDisplayFieldsTable:function(a){this.displayFieldsTable.addRow(a)},_prepareSortField:function(a,c){var b=new y;a.sorting&&a.sorting.fields?(a.sortField=this._prepareSortFieldOptions(a.sorting),b.resolve(a)):this._getLayerFields(c).then(h.hitch(this,
function(c){a.sorting?a.sorting.fields=c:a.sorting={fields:c};a.sortField=this._prepareSortFieldOptions(a.sorting);b.resolve(a)}),h.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_prepareSortFieldOptions:function(a){if(a&&a.fields&&Array.isArray(a.fields))return k.map(a.fields,function(b){var c={value:b.name,label:b.alias};a.selectedField===b.name&&(c.selected=!0);0===b.name.indexOf("expression/")&&(c.disabled=!0);return c})},_canUseOpenAtStart:function(){return this.closeable||
!this.isOnScreen},_getLayerInfoById:function(a){for(var b=0,c=this._layerInfos.length;b<c;b++)if(this._layerInfos[b].id===a)return this._layerInfos[b]},_getSupportTableInfoById:function(a){for(var b=0,c=this._tableInfos.length;b<c;b++)if(this._tableInfos[b].id===a)return this._tableInfos[b]},getConfig:function(){var a=this.displayFieldsTable.getData(),c=[],d=a.length;if(this.config&&this.config.layerInfos&&0<this.config.layerInfos.length)k.forEach(a,h.hitch(this,function(b,e){b=this.config.layerInfos[e];
var d={};d.name=b.name||b.title;d.id=b.id;d.layer={};d.layer.url=a[e].url;d.layer.fields=this._allLayerFields[e];d.show=a[e].show;d.showAttachments=a[e].showAttachments;d.sortField=a[e].sortField;d.isDescending=a[e].isDescending;c.push(d)}));else for(var e=0;e<d;e++){var f={};f.name=this._layerInfos[e].name||this._layerInfos[e].title;f.id=this._layerInfos[e].id;f.layer={};f.layer.url=a[e].url;f.layer.fields=this._allLayerFields[e];f.show=a[e].show;f.showAttachments=a[e].showAttachments;f.sortField=
a[e].sortField;f.isDescending=a[e].isDescending;c.push(f)}this.config.layerInfos=c;this.config.hideExportButton=!this.exportcsv.getValue();this.config.filterByMapExtent=this.filterByMapExtent.getValue();this.config.allowTextSelection=this.textSelection.getValue();this.config.syncWithLayers=this.syncWithLayersCheck.getValue();this._canUseOpenAtStart()||(this.config.initiallyExpand=this.expand.getValue());return this.config},_toggleTableShowOption:function(b){this.displayFieldsTable&&g(".show .jimu-checkbox").forEach(function(c){a.byNode(c).setStatus(!b)})}})});