// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/CostAnalysis/project-attribute.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTProjectAttributeTitle"\x3e\r\n      ${nls.projectAttribute.projectAttributeTitle}\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"projectAttributeNode"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.ok}"\x3e${nls.common.ok}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e${nls.common.cancel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented dijit/layout/ContentPane dijit/_WidgetsInTemplateMixin dojo/text!./project-attribute.html dojo/_base/lang dojo/_base/array dojo/dom-style dojo/on dojo/dom-construct dojo/dom-class esri/dijit/AttributeInspector esri/layers/FeatureLayer esri/tasks/query dojo/query dijit/registry dijit/focus dojo/keys dojo/_base/event dojo/dom-attr".split(" "),function(q,r,k,t,u,v,w,d,f,x,g,l,n,y,z,A,B,m,C,h,p,e){return q([r,t,v],{templateString:w,baseClass:"jimu-widget-cost-analysis-project-attribute",
projectInfo:null,_projectLayerInfo:null,_updatedFeature:null,_attributeInspector:null,postCreate:function(){this.inherited(arguments);this.onProjectLoad(this.projectInfo)},startup:function(){this.inherited(arguments);this.own(g(this.okButton,"click",d.hitch(this,function(){this._onOkButtonClicked()})));this.own(g(this.okButton,"keydown",d.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)p.stop(a),this._onOkButtonClicked()})));this.own(g(this.cancelButton,"click",d.hitch(this,function(){this.emit("onCancelButtonClicked")})));
this.own(g(this.cancelButton,"keydown",d.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)p.stop(a),this.emit("onCancelButtonClicked")})))},_onOkButtonClicked:function(){this._updatedFeature&&this._updatedFeature.getLayer().applyEdits(null,[this._updatedFeature],null,d.hitch(this,function(a,c,b){c[0].success&&this.emit("onProjectInfoUpdate",this._updatedFeature)}));this.emit("onOkButtonClicked")},onProjectLoad:function(a){this.projectInfo=a;a=this.config.projectSettings.projectLayer;
this.projectInfo.projectId&&a&&(this._projectLayerInfo=this.layerInfosObj.getLayerInfoById(a),this._loadAttributeInspector())},editProjectAttributes:function(){var a,c,b="";this._projectLayerInfo&&(this.loadingIndicator.show(),c=Date.now(),this._updatedFeature=null,a=new A,(b=this._projectLayerInfo.layerObject.getDefinitionExpression())&&this._projectLayerInfo.layerObject.setDefinitionExpression(""),a.where=this._projectLayerInfo.layerObject.globalIdField+" \x3d '"+this.projectInfo.projectId+"' AND "+
c+" \x3d "+c,this._projectLayerInfo.layerObject.selectFeatures(a,z.SELECTION_NEW,d.hitch(this,function(a){this._updatedFeature=a[0];this._attributeInspector&&(this._attributeInspector.refresh(),x.set(this._attributeInspector.attributeTable,"display",""),this._attributeInspector.attributeTable&&this._attributeInspector.attributeTable.childNodes&&0<this._attributeInspector.attributeTable.childNodes.length&&e.set(this._attributeInspector.attributeTable.childNodes[0],"cellspacing","1"));this.loadingIndicator.hide();
b&&this._projectLayerInfo.layerObject.setDefinitionExpression(b);this._add508SupportToATI()})))},mergeFirstToLast:function(){for(var a={},c=arguments.length-1,b;0<=c;c--)for(b in arguments[c])arguments[c].hasOwnProperty(b)&&(a[b]=arguments[c][b]);return a},_getFieldInfosFromLayer:function(a){var c=[];a&&a.layerObject&&f.forEach(a.layerObject.fields,function(a){var b=k.getDefaultPortalFieldInfo(a),b=this.mergeFirstToLast(b,a);b.format&&b.format.dateFormat&&b.format.dateFormat.toLowerCase()&&0<=b.format.dateFormat.toLowerCase().indexOf("time")&&
(b.format.time=!0);b.visible=!0;c.push(b)},this);return c},_createFieldInfos:function(){var a,c;c=this._projectLayerInfo.controlPopupInfo&&this._projectLayerInfo.controlPopupInfo.enablePopup&&this._projectLayerInfo.controlPopupInfo.infoTemplate?d.clone(this._projectLayerInfo.controlPopupInfo.infoTemplate.info.fieldInfos):this._getFieldInfosFromLayer(this._projectLayerInfo);a=[];f.forEach(c,d.hitch(this,function(b){if(b.visible){if("PROJECTNAME"===b.fieldName.toUpperCase()||"TOTALASSETCOST"===b.fieldName.toUpperCase()||
"GROSSPROJECTCOST"===b.fieldName.toUpperCase())b.isEditable=!1;a.push(b)}}));return a},_loadAttributeInspector:function(){var a,c;this._projectLayerInfo&&(c=this._createFieldInfos(),l.empty(this.projectAttributeNode),a=new u({style:{padding:"0"}},l.create("div",{},this.projectAttributeNode)),this._attributeInspector=new y({layerInfos:[{featureLayer:this._projectLayerInfo.layerObject,showAttachments:!1,isEditable:!0,fieldInfos:c}]},l.create("div")),this._attributeInspector.on("attribute-change",d.hitch(this,
function(b){this._updatedFeature.attributes[b.fieldName]=b.fieldValue})),n.add(this._attributeInspector.layerName,"esriCTHidden"),n.add(this._attributeInspector.editButtons,"esriCTHidden"),a.setContent(this._attributeInspector.domNode))},_add508SupportToATI:function(){var a,c;this._attributeInspector&&this._attributeInspector.domNode&&(a=m.findWidgets(this._attributeInspector.domNode),f.forEach(a,d.hitch(this,function(b){b.focusNode&&!c&&(c=b.focusNode,k.initFirstFocusNode(this.widgetDomNode,b.focusNode),
C.focus(b.focusNode));b.hasOwnProperty("focusNode")&&b.focusNode.disabled&&(e.set(b.focusNode,"disabled",!1),e.set(b.focusNode,"tabindex",0),e.set(b.focusNode,"readOnly",!0),e.set(b.focusNode,"aria-disabled","true"))})),(a=B("td.atiLabel",this._attributeInspector.domNode))&&f.forEach(a,d.hitch(this,function(b){var a=this._getAttrInspectorRowInfo(b);a&&(a[0].set("aria-label",a[1]),1<b.parentNode.childNodes[1].childNodes.length&&(b=b.parentNode.childNodes[1].childNodes[1],b=m.getEnclosingWidget(b),
b.set("aria-label",a[1])))})));k.initLastFocusNode(this.widgetDomNode,this.cancelButton)},_getAttrInspectorRowInfo:function(a){try{if(a&&a.parentNode){var c=a.parentNode.childNodes[1].childNodes[0];return[m.getEnclosingWidget(c),a.childNodes[0].data,c]}return null}catch(b){return console.log(b),null}}})});