// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/BusinessAnalyst/RunReportsPage.html":'\x3cdiv\x3e\r\n\t\x3cdiv style\x3d"width: 350 px; height: 150px"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"runReportTabContainer" style\x3d"width: 100%; height: 155px;"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"infographicsContentPane" title\x3d"${nls.infographics}" style\x3d"overflow-y: hidden"\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top: 15px;"\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"height: 40px;" data-dojo-attach-point\x3d"infographicDropDownContainer"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3cbr /\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-btn runReportButton jimu-state-disabled" data-dojo-attach-point\x3d"runInfographicBtn" data-dojo-attach-event\x3d"onclick:runInfographic"\x3e${nls.runInfographic}\x3c/div\x3e\r\n\t\t\t\t\t\x3ca href\x3d"https://doc.arcgis.com/en/arcgis-online/reference/credits.htm" target\x3d"_blank" class\x3d"esriFloatTrailing esriSmallFont"\x3e${nls.creditInformation}\x3c/a\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"reportsContentPane" title\x3d"${nls.reports}" style\x3d"overflow-y: hidden"\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top: 15px;"\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"height: 40px;" data-dojo-attach-point\x3d"reportFilteringSelectDropDownContainer"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3cbr /\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-btn runReportButton jimu-state-disabled" data-dojo-attach-point\x3d"runReportBtn" data-dojo-attach-event\x3d"onclick:runReport"\x3e${nls.runReport}\x3c/div\x3e\r\n\t\t\t\t\t\x3ca href\x3d"https://doc.arcgis.com/en/arcgis-online/reference/credits.htm" target\x3d"_blank" class\x3d"esriFloatTrailing esriSmallFont"\x3e${nls.creditInformation}\x3c/a\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cbr\x3e\r\n\t\x3cdiv class\x3d"jimu-btn jimu-btn-vacation" data-dojo-attach-point\x3d"backBtn" data-dojo-attach-event\x3d"onclick:backOnClick"\x3e${nls.back}\x3c/div\x3e\r\n\r\n\t\x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/dom-style dojo/query dojo/when dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin esri/dijit/geoenrichment/SelectableTree esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/ReportPlayer esri/dijit/geoenrichment/ReportPlayer/PlayerResizeModes esri/dijit/geoenrichment/ReportPlayer/PlayerThemes esri/dijit/geoenrichment/ReportPlayer/DataProviderGE esri/dijit/geoenrichment/ReportPlayer/PlayerCommands esri/dijit/geoenrichment/_WizardPage esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/ReportTemplateTypes ./utils/GEUtil ./utils/ReportUtil ./esriAnalystX/widgets/Selects/FilteringSelectTree dojo/text!./RunReportsPage.html jimu/dijit/TabContainer3 jimu/utils".split(" "),
function(g,u,f,m,v,w,n,x,y,z,h,r,A,B,t,C,l,D,E,p,k,q,F,G,H){return u([y,x,D,z],{templateString:F,infographicsTabHidden:!1,reportsTabHidden:!1,_infograpicReports:null,_configForLightTheme:[{name:"DashboardTheme",style:"light"}],postCreate:function(){this.inherited(arguments);this.tab=new G({tabs:[{title:this.nls.infographics,content:this.infographicsContentPane},{title:this.nls.reports,content:this.reportsContentPane}],selected:this.nls.infographics});this.tab.placeAt(this.runReportTabContainer);this.tab.startup()},
startup:function(){this.inherited(arguments)},loadReportsInfographicsForCountry:function(b){var a=this;n(k.getAvailableClassicReports(b,this.config),function(b){a.filteredReportDropDown?a.filteredReportDropDown.set("tree",new h(b)):(a.filteredReportDropDown=new q({name:"filteredReportSelect",tree:new h(b),defaultExpand:{esriReports:!0},placeHolder:a.nls.selectReport,onChange:function(b){a._enableDisableButton(a.runReportBtn,b)}},a.reportFilteringSelectDropDownContainer),a.filteredReportDropDown.startup());
a.reportsTabHidden=a.config.reportsDisabled||!a._areReportsAvailable(b)});n(k.getAvailableInfographicReports(b,this.config),function(b){a.infographicDropDown?a.infographicDropDown.set("tree",new h(b)):(a.infographicDropDown=new q({name:"filteredInfographicReportSelect",tree:new h(b),defaultExpand:{esriReports:!0},placeHolder:a.nls.selectTemplate,onChange:function(b){a._enableDisableButton(a.runInfographicBtn,b)}},a.infographicDropDownContainer),a.infographicDropDown.startup());a.infographicsTabHidden=
a.config.infographicsDisabled||!a._areReportsAvailable(b);a._infograpicReports=b})},_areReportsAvailable:function(b){if(0==b.length)return!1;var a=!1;g.forEach(b,function(b){0<b.children.length&&(a=!0)});return a},refresh:function(){this._hideOrShowTabs()},_hideOrShowTabs:function(){this._hideOrShowTab(this.nls.infographics,this.infographicsTabHidden);this._hideOrShowTab(this.nls.reports,this.reportsTabHidden);this.infographicsTabHidden?this.tab.selectTab(this.nls.reports):this.tab.selectTab(this.nls.infographics)},
_hideOrShowTab:function(b,a){var c=w("td",this.tab.tabTr),e;g.some(c,function(a){if(a.label===b)return e=a,!0})&&v.set(e,"display",a?"none":"")},runInfographic:function(){if(!f.contains(this.runInfographicBtn,"jimu-state-disabled")){var b=this,a=this.infographicDropDown.get("value");this.reportPlayer&&this.reportPlayer.destroy();this.playerDiv&&m.destroy(this.playerDiv);this.playerDiv=m.create("div",null,document.body);var c=new C;c.registerCommand(l.PDF);c.registerCommand(l.IMAGE);c.registerCommand(l.PRINT);
c.registerCommand(l.DYNAMIC_HTML);var e=H.isMobileUa();this.reportPlayer=(new A({isSlidesView:e?!0:!1,theme:this._useLightTheme()?t.LIGHT:t.DARK,dataProvider:c,resizeMode:B.FIT_WINDOW,showCloseButton:!0,config:{esriDijitCssUrl:"https://js.arcgis.com/3.30/dijit/themes/claro/claro.css",esriCssUrl:"https://js.arcgis.com/3.30/esri/css/esri.css",playerSourceRootUrl:"https://js.arcgis.com/3.30/"},onClose:function(){b.reportPlayer.destroy();m.destroy(b.playerDiv)}})).placeAt(this.playerDiv);var d=!0,c=new q({name:"filteredInfographicReportSelect",
tree:new h(this._infograpicReports),defaultExpand:{esriReports:!0},placeHolder:b.nls.selectTemplate,value:a,onChange:function(a){d?d=!1:(b.infographicDropDown.set("value",a),k(a))}});this._useLightTheme()||f.add(this.reportPlayer.playerToolbar.domNode,"jimu-main-background");c.startup();c.set("value",a);this.reportPlayer.playerToolbar.addInfographicsSelect(c);var k=function(a){var c=[];if(b.wizard.selectedPoint.long)g.forEach(b.wizard.selectedPoint.tradeAreas,function(a,d){var e={};e.name=a.name;
e.shortName=a.shortName;e.feature=a.graphic;"undefined"===typeof e.feature.attributes&&(e.feature.attributes={});e.feature.attributes.STORE_LONG=b.wizard.selectedPoint.long;e.feature.attributes.STORE_LAT=b.wizard.selectedPoint.lat;e.feature.attributes.radiusIndex=d;c.push(e)});else if(b.wizard.selectedPolygon.geometry){var c=[],d={};d.name=b.wizard.selectedPolygon.locationName;d.shortName=b.wizard.selectedPolygon.locationName;d.feature=b.wizard.selectedPolygon.feature;c.push(d)}b.reportPlayer.playReport({portalUrl:portalUrl,
countryID:b.wizard.selectedCountryID,reportID:a,analysisAreas:c})};n(p.getGEProxyUrl(this.appConfig),function(b){b&&(r.setGeoenrichmentUrl(b),r.getClient());k(a)})}},_useLightTheme:function(){var b=!1,a=self.getAppConfig();g.forEach(this._configForLightTheme,function(c){a&&a.theme&&a.theme.name==c.name&&a.theme.styles&&0<a.theme.styles.length&&g.forEach(a.theme.styles,function(a){a==c.style&&(b=!0)})});a&&a.theme&&a.theme.customStyles&&a.theme.customStyles.mainBackgroundColor&&"#FFFFFF"==a.theme.customStyles.mainBackgroundColor.toUpperCase()&&
(b=!0);return b},runReport:function(){if(!f.contains(this.runReportBtn,"jimu-state-disabled")){f.add(this.runReportBtn,"jimu-state-disabled");this.shelter.show();var b=this;this.wizard.selectedPoint.long?this.runReportForPoint().then(function(){b.shelter.hide();f.remove(b.runReportBtn,"jimu-state-disabled")}).otherwise(function(){b.shelter.hide();f.remove(b.runReportBtn,"jimu-state-disabled")}):this.wizard.selectedPolygon.geometry&&this.runReportForPolygon().then(function(){b.shelter.hide();f.remove(b.runReportBtn,
"jimu-state-disabled")}).otherwise(function(){b.shelter.hide();f.remove(b.runReportBtn,"jimu-state-disabled")})}},_enableDisableButton:function(b,a){"string"==typeof a&&"None"!=a?f.remove(b,"jimu-state-disabled"):f.add(b,"jimu-state-disabled")},runReportForPoint:function(){var b=this,a={studyAreas:[]},c={featureSet:{fields:[{name:"OBJECTID",alias:"Object ID",type:"esriFieldTypeOID"},{name:"STORE_ID",alias:"STORE_ID",type:"esriFieldTypeString",length:1,nullable:!0},{name:"STORE_LONG",alias:"STORE_LONG",
type:"esriFieldTypeDouble"},{name:"STORE_LAT",alias:"STORE_LAT",type:"esriFieldTypeDouble"},{name:"AREA_DESC",alias:"AREA_DESC",type:"esriFieldTypeString",length:7,nullable:!0},{name:"AREA_DESC2",alias:"AREA_DESC2",type:"esriFieldTypeString",length:19,nullable:!0}],spatialReference:this.map.spatialReference.toJson(),geometryType:"esriGeometryPolygon",features:[]}};g.forEach(this.wizard.selectedPoint.tradeAreas,function(a){var d={};d.geometry=a.graphic.geometry;d.attributes=a.graphic.attributes;d.attributes||
(d.attributes={});d.attributes.OBJECTID=1;d.attributes.STORE_ID="1";d.attributes.STORE_LONG=b.wizard.selectedPoint.long;d.attributes.STORE_LAT=b.wizard.selectedPoint.lat;d.attributes.AREA_DESC=a.AREA_DESC;d.attributes.AREA_DESC2=a.AREA_DESC2;c.featureSet.features.push(d)});a.studyAreas.push(c);this.filteredReportDropDown.getSelectedItem().reportType!=E.STANDARD&&(a.areadesc2=this.wizard.selectedPoint.areadesc2);a.locationName=this.wizard.selectedPoint.locationName;a.lat=this.wizard.selectedPoint.lat;
a.long=this.wizard.selectedPoint.long;a.sourceCountry=this.wizard.selectedCountryID;a.report=this.filteredReportDropDown.getSelectedItem().item?this.filteredReportDropDown.getSelectedItem().item:this.filteredReportDropDown.getSelectedItem().value;a.reportDownloadName=this.filteredReportDropDown.getSelectedItem().label;return p.createReport(a)},runReportForPolygon:function(){var b={studyAreas:[]},a={geometry:this.wizard.selectedPolygon.geometry.toJson()};b.studyAreas.push(a);b.locationName=this.wizard.selectedPolygon.locationName;
b.sourceCountry=this.wizard.selectedCountryID;b.report=this.filteredReportDropDown.getSelectedItem().item?this.filteredReportDropDown.getSelectedItem().item:this.filteredReportDropDown.getSelectedItem().value;b.reportDownloadName=this.filteredReportDropDown.getSelectedItem().label;return p.createReport(b)},backOnClick:function(){this.onBack()}})});